<html>
<head>
    <title>Test</title>

    <script src="default.js" type="text/javascript"></script>

    <script src="jsTemplate.js" type="text/javascript"></script>

    <style>
        ol, ul { list-style: none; padding: 0px; margin: 0px; }
        input { width: 50px; }
        /*elimnates bullets */.imagecontainer { float: left; width: 25px; }
        .storyTitle { float: left; width: 100px; margin-left: 25px; }
        .storyDesc { float: left; width: 200px; margin-left: 25px; }
        .storyRank { float: left; width: 125px; margin-left: 25px; }
        /**/.storyListBox { float: left; }
        .move { float: left; }
        .photolistitem { position: relative; list-style-type: none; background-color: #ffffff; border: solid 1px black; float: left; *float:none;/* IE7 Bug */width:650px;vertical-align:middle;padding:10px;}
        .photolistitemHeader { position: relative; float: left; overflow: inherit; list-style-type: none; border: solid 1px black; width: 650px; vertical-align: middle; padding: 10px; clear: both; background-color: #3357B6; }
        .headerText { font-weight: bold; font-size: 13px; color: #ffffff; text-align: center; }
        .bottomLi { position: relative; list-style-type: none; float: left; *float:none;/* IE7 Bug */}
        #ulThumbnailList { cursor: pointer; }
    </style>

    <script>

        var data = {
            name: 'Item list',
            list_id: 4,
            table: [
      { id: 1, title: 'Anne', originalOrder: 22, desc: 'anne@domain.com' },
      { id: 2, title: 'Amelie', originalOrder: 24, desc: 'amelie@domain.com' },
      { id: 3, title: 'Polly', originalOrder: 18, desc: 'polly@domain.com' },
      { id: 4, title: 'Alice', originalOrder: 26, desc: 'alice@domain.com' },
      { id: 5, title: 'Martha', originalOrder: 25, desc: 'martha@domain.com' }
     ]
        };


        $(document).ready(function() {


            $("#ulThumbnailList").setTemplateURL("itemTemplate.htm");
            $("#ulThumbnailList").processTemplate(data);
            //    DIV.setTemplateURL(commentTemplateURL);
            //            DIV.processTemplate(msg.d);
            $("#ulThumbnailList").sortable({ opacity: 0.7,
                revert: true,
                scroll: true,
                handle: $(".imagecontainer").add(".imagecontainer a img"),
                update: function() { ResetTextBoxes(); $('.savelabel').hide() }
            }); //see if you can find a better place to run "update" making dropped row be "5"
        })
    </script>

    <script>



    </script>

</head>
<body style="width: 800px; margin: 100px auto;">
    <input type="text" id="textBox1111" onblur="updateByText(this.value, 10);" value="10" />
    <ul>
        <li class="photolistitemHeader" style="">
            <div class="imagecontainer">
                &nbsp;
            </div>
            <div class="move headerText">
                Controls
            </div>
            <div class="storyTitle headerText">
                Story Title
            </div>
            <div class="storyDesc headerText">
                Story Description
            </div>
            <div class="storyRank headerText">
                Story Display Order
            </div>
        </li>
        <!--<li id="topItem" style="height: 0px;"></li>-->
    </ul>
    <ul id="ulThumbnailList">
    </ul>
    <div class="photolistitemHeader" style="background-color: #3357B6;">
        instrucitons here
    </div>
    <input type="button" onclick="CheckOrder();" value="Check Order" />

    <script>

        //Pulls selected item out of sortable and slides it to the top of the sortable. Nice slide and swing annimation.
        function moveTop(id) {
            var F = $("#" + id);
            var T = $("#ulThumbnailList > li:first") //$("#topItem") //$("#itemContainer > li:last")
            var topX = T.offset().top;
            var itemX = F.offset().top;
            var travelDistance = topX - itemX
            F.animate(
    { top: "+=5", left: "+=2" },
    "fast",
    "swing",
    function() {
        F.animate(
              { top: travelDistance + "px" },
              "normal",
              "swing",
              function() { F.insertAfter(T).css({ top: "0px", left: "0px" }); ResetTextBoxes(); }
          )
    }
    );

        }

        //Moves selected item to bottom of sortable. Animates selected to flow to the bottom behind all rows.  Need to find method to allwo row to slide in front of everthing, z-index maybe
        function moveBottom(id) {
            //$("#"+id).insertBefore("#bottomItem");
            var F = $("#" + id);
            var B = $("#ulThumbnailList > li:last")
            var T = $("#ulThumbnailList > li:first")//$("#topItem"); //$("#itemContainer > li:last")
            //var test = $("#testDiv");
            var topX = T.offset().top;
            var bottomX = B.offset().top;
            var itemX = F.offset().top;
            var travelDistance = bottomX - itemX;
            //alert(travelDistance);
            //alert("Top X" + topX + " Item X "+ itemX + " Bottom X" + bottomX + " test Div" + test.offset().top);
            F.animate(
            { top: "+=5", left: "-=10" },
            "fast",
            "swing",
            function() {
                F.animate(
                      { top: travelDistance + "px" },
                      "normal",
                      "swing",
                      function() { F.insertAfter(B).css({ top: "0px", left: "0px" }); ResetTextBoxes(); }
                  )
            }
    );



        }


        //Function to double check order of sortable
        function CheckOrder() {
            var items = $(".photolistitem");
            var photos = Array();

            for (var x = 0; x < items.length; x++) {
                var photo = {}
                photos[x] = items[x].id;
            }

            var parms = { "stories": photos.join() };
            alert(photos);
        }


        /////Updating the sortable by use of text boxes
        function updateByText(newPosition, id) {
            var items = $(".photolistitem");
            var li = $("#" + id);
            var currentPosition = items.index(li);

            var newLi = $("#" + newPosition)

            var desiredPosition = items.index(newLi);

            //newPosition = newPosition + 1;


            //alert("Current Position "+currentPosition+" Desired Position "+desiredPosition);

            if (desiredPosition == -1) {
                //Desired position not found Send to Bottom
                moveBottom(id);
                return
            }

            if (desiredPosition > currentPosition) {
                //Send to the below
                var topItem = li.offset().top
                var bottomItem = newLi.offset().top
                var travelDistance = bottomItem - topItem;
                li.animate(
        { top: "+=5", left: "-=10" },
        "fast",
        "swing",
        function() {
            li.animate(
                  { top: travelDistance + "px" },
                  "normal",
                  "swing",
                  function() { li.insertBefore(newLi).css({ top: "0px", left: "0px" }); ResetTextBoxes(); }
              )
        }
        );
                //Reset text boxes
                return
            }

            if (desiredPosition < currentPosition) {
                //Send above
                var topItem = newLi.offset().top
                var bottomItem = li.offset().top
                var travelDistance = topItem - bottomItem;
                li.animate(
        { top: "+=5", left: "-=10" },
        "fast",
        "swing",
        function() {
            li.animate(
                  { top: travelDistance + "px" },
                  "normal",
                  "swing",
                  function() { li.insertBefore(newLi).css({ top: "0px", left: "0px" }); ResetTextBoxes(); }
              )
        }
        );
                return
            }
        }

        //Runs a select and resets the input boxes on the page with the appropriate value.  Function is run often. See if there is a way to execute faster with less code.
        function ResetTextBoxes() {


            setTimeout(function() {
                var items = $(".photolistitem");
                var photos = Array();
                //CheckOrder();


                for (var x = 0; x < items.length; x++) {
                    //var photo = {}
                    //photos[x] = items[x].id;
                    $("#textBox" + items[x].id).val(x + 1)
                    //alert(items[x].id);
                }
            }
            , 1);
        }



    </script>

</body>
</html>
